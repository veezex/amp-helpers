<!DOCTYPE html>
<html>
    <head>
        <title>AMP iframe</title>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"
        />
        <style>
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>
        <div id="iframe"></div>
        <script>
            function setParentHeight(height) {
                window.parent.postMessage(
                    {
                        sentinel: 'amp',
                        type: 'embed-size',
                        height: height,
                    },
                    '*'
                )
            }
        </script>
        <script>
            function getLink() {
                var params = new URLSearchParams(window.location.search)
                return params.get('url')
            }
            function resizeIframe() {
                const height = this.contentWindow.document.documentElement.scrollHeight
                this.style.height = height + 'px'
                setParentHeight(height)
            }

            var iframe = document.createElement('iframe')
            var container = document.getElementById('iframe')

            iframe.src = getLink()
            iframe.frameBorder = 0
            iframe.scrolling = 'no'
            iframe.allowTransparency = 'true'
            iframe.tabIndex = 0
            iframe.title = 'AMP iframe'
            iframe.width = '100%'
            iframe.snadbox = 'allow-scripts allow-popups allow-forms allow-same-origin'
            iframe.horizontalScrolling = 'no'
            iframe.verticalScrolling = 'no'
            iframe.onload = resizeIframe

            container.appendChild(iframe)
        </script>
    </body>
</html>
